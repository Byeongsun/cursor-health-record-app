---
globs: src/pages/HealthRecordPage.tsx,src/store/slices/healthRecordsSlice.ts
description: Health Data Management Guidelines
---

# ğŸ¥ Health Data Management Guidelines

## ğŸ“Š Health Record Types

### Record Type Definitions
```typescript
// âœ… Define health record types
type RecordType = 'blood_pressure' | 'blood_sugar' | 'weight' | 'heart_rate' | 'temperature'

interface HealthRecord {
  id: string
  user_id: string
  record_type: RecordType
  systolic_pressure?: number
  diastolic_pressure?: number
  heart_rate?: number
  blood_sugar?: number
  blood_sugar_type?: 'fasting' | 'post_meal'
  weight?: number
  temperature?: number
  measurement_time: string
  notes?: string
  created_at: string
}
```

### Health Metric Interfaces
```typescript
// âœ… Specific interfaces for each health metric
interface BloodPressureRecord {
  systolic_pressure: number
  diastolic_pressure: number
  heart_rate?: number
  measurement_time: string
  notes?: string
}

interface BloodSugarRecord {
  blood_sugar: number
  blood_sugar_type: 'fasting' | 'post_meal'
  measurement_time: string
  notes?: string
}

interface WeightRecord {
  weight: number
  measurement_time: string
  notes?: string
}
```

## âœ… Form Validation

### Blood Pressure Validation
```typescript
// âœ… Blood pressure validation rules
const validateBloodPressure = (data: BloodPressureRecord): string | null => {
  if (!data.systolic_pressure || !data.diastolic_pressure) {
    return 'ìˆ˜ì¶•ê¸°ì™€ ì´ì™„ê¸° í˜ˆì••ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'
  }
  
  if (data.systolic_pressure < 50 || data.systolic_pressure > 300) {
    return 'ìˆ˜ì¶•ê¸° í˜ˆì••ì€ 50-300 mmHg ë²”ìœ„ì—¬ì•¼ í•©ë‹ˆë‹¤.'
  }
  
  if (data.diastolic_pressure < 30 || data.diastolic_pressure > 200) {
    return 'ì´ì™„ê¸° í˜ˆì••ì€ 30-200 mmHg ë²”ìœ„ì—¬ì•¼ í•©ë‹ˆë‹¤.'
  }
  
  if (data.systolic_pressure <= data.diastolic_pressure) {
    return 'ìˆ˜ì¶•ê¸° í˜ˆì••ì€ ì´ì™„ê¸° í˜ˆì••ë³´ë‹¤ ë†’ì•„ì•¼ í•©ë‹ˆë‹¤.'
  }
  
  return null
}
```

### Blood Sugar Validation
```typescript
// âœ… Blood sugar validation rules
const validateBloodSugar = (data: BloodSugarRecord): string | null => {
  if (!data.blood_sugar || !data.blood_sugar_type) {
    return 'í˜ˆë‹¹ ìˆ˜ì¹˜ì™€ ì¸¡ì • ìœ í˜•ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'
  }
  
  if (data.blood_sugar < 50 || data.blood_sugar > 500) {
    return 'í˜ˆë‹¹ì€ 50-500 mg/dL ë²”ìœ„ì—¬ì•¼ í•©ë‹ˆë‹¤.'
  }
  
  return null
}
```

### Weight Validation
```typescript
// âœ… Weight validation rules
const validateWeight = (data: WeightRecord): string | null => {
  if (!data.weight) {
    return 'ì²´ì¤‘ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'
  }
  
  if (data.weight < 20 || data.weight > 300) {
    return 'ì²´ì¤‘ì€ 20-300 kg ë²”ìœ„ì—¬ì•¼ í•©ë‹ˆë‹¤.'
  }
  
  return null
}
```

## ğŸ“ Input Ranges & Constraints

### Health Metric Ranges
```typescript
// âœ… Define input ranges for each health metric
export const HEALTH_METRIC_RANGES = {
  blood_pressure: {
    systolic: { min: 50, max: 300, unit: 'mmHg' },
    diastolic: { min: 30, max: 200, unit: 'mmHg' },
    heart_rate: { min: 30, max: 200, unit: 'bpm' }
  },
  blood_sugar: {
    value: { min: 50, max: 500, unit: 'mg/dL' },
    types: ['fasting', 'post_meal'] as const
  },
  weight: {
    value: { min: 20, max: 300, step: 0.1, unit: 'kg' }
  },
  temperature: {
    value: { min: 35, max: 42, step: 0.1, unit: 'Â°C' }
  }
} as const
```

### Input Field Configuration
```typescript
// âœ… Configure input fields based on health metric
const getInputConfig = (recordType: RecordType) => {
  switch (recordType) {
    case 'blood_pressure':
      return {
        fields: [
          { name: 'systolic_pressure', label: 'ìˆ˜ì¶•ê¸° í˜ˆì••', type: 'number' },
          { name: 'diastolic_pressure', label: 'ì´ì™„ê¸° í˜ˆì••', type: 'number' },
          { name: 'heart_rate', label: 'ë§¥ë°• (ì„ íƒì‚¬í•­)', type: 'number', optional: true }
        ],
        validation: validateBloodPressure
      }
    case 'blood_sugar':
      return {
        fields: [
          { name: 'blood_sugar', label: 'í˜ˆë‹¹ ìˆ˜ì¹˜', type: 'number' },
          { name: 'blood_sugar_type', label: 'ì¸¡ì • ìœ í˜•', type: 'select' }
        ],
        validation: validateBloodSugar
      }
    case 'weight':
      return {
        fields: [
          { name: 'weight', label: 'ì²´ì¤‘', type: 'number' }
        ],
        validation: validateWeight
      }
    default:
      return { fields: [], validation: () => null }
  }
}
```

## ğŸ¨ UI Patterns

### Health Metric Icons & Colors
```typescript
// âœ… Define visual indicators for health metrics
export const HEALTH_METRIC_INFO = {
  blood_pressure: {
    title: 'í˜ˆì•• ì¸¡ì •',
    icon: <BloodPressureIcon sx={{ fontSize: 40 }} />,
    color: '#e74c3c',
    description: 'ìˆ˜ì¶•ê¸°ì™€ ì´ì™„ê¸° í˜ˆì••ì„ ì…ë ¥í•´ì£¼ì„¸ìš”',
    emoji: 'â¤ï¸'
  },
  blood_sugar: {
    title: 'í˜ˆë‹¹ ì¸¡ì •',
    icon: <BloodSugarIcon sx={{ fontSize: 40 }} />,
    color: '#3498db',
    description: 'ê³µë³µ ë˜ëŠ” ì‹í›„ í˜ˆë‹¹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”',
    emoji: 'ğŸ©¸'
  },
  weight: {
    title: 'ì²´ì¤‘ ì¸¡ì •',
    icon: <WeightIcon sx={{ fontSize: 40 }} />,
    color: '#27ae60',
    description: 'í˜„ì¬ ì²´ì¤‘ì„ ì…ë ¥í•´ì£¼ì„¸ìš”',
    emoji: 'âš–ï¸'
  },
  heart_rate: {
    title: 'ë§¥ë°• ì¸¡ì •',
    icon: <HeartRateIcon sx={{ fontSize: 40 }} />,
    color: '#f39c12',
    description: 'ì‹¬ë°•ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”',
    emoji: 'ğŸ’“'
  },
  temperature: {
    title: 'ì²´ì˜¨ ì¸¡ì •',
    icon: <TemperatureIcon sx={{ fontSize: 40 }} />,
    color: '#e67e22',
    description: 'í˜„ì¬ ì²´ì˜¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”',
    emoji: 'ğŸŒ¡ï¸'
  }
} as const
```

### Form Field Rendering
```typescript
// âœ… Render form fields based on record type
const renderFormFields = (recordType: RecordType) => {
  const info = HEALTH_METRIC_INFO[recordType]
  const config = getInputConfig(recordType)
  
  return (
    <Box sx={{ mb: 3 }}>
      <Typography variant="h6" gutterBottom sx={{ color: info.color }}>
        {info.emoji} {info.title}
      </Typography>
      <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
        {info.description}
      </Typography>
      
      {config.fields.map(field => (
        <TextField
          key={field.name}
          fullWidth
          label={field.label}
          type={field.type}
          value={formData[field.name] || ''}
          onChange={(e) => handleInputChange(field.name, e.target.value)}
          size="large"
          sx={{ fontSize: '1.2rem', mb: 2 }}
          inputProps={{ 
            style: { fontSize: '1.2rem' },
            min: HEALTH_METRIC_RANGES[recordType]?.[field.name]?.min,
            max: HEALTH_METRIC_RANGES[recordType]?.[field.name]?.max,
            step: HEALTH_METRIC_RANGES[recordType]?.[field.name]?.step
          }}
        />
      ))}
    </Box>
  )
}
```

## ğŸ“Š Data Display Patterns

### Recent Records Display
```typescript
// âœ… Display recent health records
const getRecentRecords = (recordType: RecordType, limit: number = 3) => {
  return records
    .filter(record => record.record_type === recordType)
    .sort((a, b) => new Date(b.measurement_time).getTime() - new Date(a.measurement_time).getTime())
    .slice(0, limit)
}

const formatHealthValue = (record: HealthRecord) => {
  switch (record.record_type) {
    case 'blood_pressure':
      return `${record.systolic_pressure}/${record.diastolic_pressure} mmHg`
    case 'blood_sugar':
      return `${record.blood_sugar} mg/dL`
    case 'weight':
      return `${record.weight} kg`
    case 'heart_rate':
      return `${record.heart_rate} bpm`
    case 'temperature':
      return `${record.temperature}Â°C`
    default:
      return 'N/A'
  }
}
```

### Health Status Indicators
```typescript
// âœ… Health status color coding
const getHealthStatusColor = (record: HealthRecord): string => {
  switch (record.record_type) {
    case 'blood_pressure':
      if (record.systolic_pressure! > 140 || record.diastolic_pressure! > 90) {
        return '#e74c3c' // Red - High blood pressure
      } else if (record.systolic_pressure! > 120 || record.diastolic_pressure! > 80) {
        return '#f39c12' // Orange - Elevated
      }
      return '#27ae60' // Green - Normal
      
    case 'blood_sugar':
      if (record.blood_sugar_type === 'fasting') {
        if (record.blood_sugar! > 126) return '#e74c3c' // Red - Diabetic
        if (record.blood_sugar! > 100) return '#f39c12' // Orange - Pre-diabetic
        return '#27ae60' // Green - Normal
      } else {
        if (record.blood_sugar! > 200) return '#e74c3c' // Red - High
        if (record.blood_sugar! > 140) return '#f39c12' // Orange - Elevated
        return '#27ae60' // Green - Normal
      }
      
    default:
      return '#3498db' // Blue - Default
  }
}
```

## ğŸ“… Date & Time Handling

### Korean Date Formatting
```typescript
// âœ… Format dates for Korean users
export const formatKoreanDate = (dateString: string): string => {
  const date = new Date(dateString)
  return date.toLocaleDateString('ko-KR', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  })
}

export const formatKoreanTime = (dateString: string): string => {
  const date = new Date(dateString)
  return date.toLocaleTimeString('ko-KR', {
    hour: '2-digit',
    minute: '2-digit'
  })
}
```

### Time Zone Handling
```typescript
// âœ… Handle time zones properly
export const getCurrentDateTime = (): string => {
  const now = new Date()
  // Convert to local timezone
  const offset = now.getTimezoneOffset()
  const localTime = new Date(now.getTime() - (offset * 60 * 1000))
  return localTime.toISOString().slice(0, 16)
}
```

## ğŸ”„ Data Processing

### Health Record Aggregation
```typescript
// âœ… Aggregate health data for insights
export const getHealthInsights = (records: HealthRecord[]) => {
  const bloodPressureRecords = records.filter(r => r.record_type === 'blood_pressure')
  const bloodSugarRecords = records.filter(r => r.record_type === 'blood_sugar')
  const weightRecords = records.filter(r => r.record_type === 'weight')
  
  return {
    bloodPressure: {
      count: bloodPressureRecords.length,
      average: bloodPressureRecords.length > 0 ? {
        systolic: bloodPressureRecords.reduce((sum, r) => sum + (r.systolic_pressure || 0), 0) / bloodPressureRecords.length,
        diastolic: bloodPressureRecords.reduce((sum, r) => sum + (r.diastolic_pressure || 0), 0) / bloodPressureRecords.length
      } : null
    },
    bloodSugar: {
      count: bloodSugarRecords.length,
      average: bloodSugarRecords.length > 0 ? 
        bloodSugarRecords.reduce((sum, r) => sum + (r.blood_sugar || 0), 0) / bloodSugarRecords.length : null
    },
    weight: {
      count: weightRecords.length,
      average: weightRecords.length > 0 ?
        weightRecords.reduce((sum, r) => sum + (r.weight || 0), 0) / weightRecords.length : null,
      trend: weightRecords.length > 1 ? 
        (weightRecords[0].weight || 0) - (weightRecords[weightRecords.length - 1].weight || 0) : 0
    }
  }
}
```

### Data Export
```typescript
// âœ… Export health data
export const exportHealthData = (records: HealthRecord[], format: 'csv' | 'json' = 'csv') => {
  if (format === 'csv') {
    const headers = ['ë‚ ì§œ', 'ì¸¡ì • ìœ í˜•', 'ìˆ˜ì¶•ê¸° í˜ˆì••', 'ì´ì™„ê¸° í˜ˆì••', 'ë§¥ë°•', 'í˜ˆë‹¹', 'í˜ˆë‹¹ ìœ í˜•', 'ì²´ì¤‘', 'ë©”ëª¨']
    const csvContent = [
      headers.join(','),
      ...records.map(record => [
        formatKoreanDate(record.measurement_time),
        HEALTH_METRIC_INFO[record.record_type]?.title || record.record_type,
        record.systolic_pressure || '',
        record.diastolic_pressure || '',
        record.heart_rate || '',
        record.blood_sugar || '',
        record.blood_sugar_type || '',
        record.weight || '',
        record.notes || ''
      ].join(','))
    ].join('\n')
    
    return csvContent
  }
  
  return JSON.stringify(records, null, 2)
}
```

## ğŸš¨ Error Handling

### Health Data Errors
```typescript
// âœ… Health-specific error messages
export const HEALTH_ERROR_MESSAGES = {
  INVALID_BLOOD_PRESSURE: 'í˜ˆì•• ìˆ˜ì¹˜ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.',
  INVALID_BLOOD_SUGAR: 'í˜ˆë‹¹ ìˆ˜ì¹˜ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.',
  INVALID_WEIGHT: 'ì²´ì¤‘ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.',
  MISSING_REQUIRED_FIELDS: 'í•„ìˆ˜ ì…ë ¥ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.',
  FUTURE_DATE: 'ë¯¸ë˜ ë‚ ì§œëŠ” ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
  INVALID_DATE_RANGE: 'ë‚ ì§œ ë²”ìœ„ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'
} as const

const validateHealthRecord = (record: Partial<HealthRecord>): string | null => {
  // Check for future dates
  if (record.measurement_time && new Date(record.measurement_time) > new Date()) {
    return HEALTH_ERROR_MESSAGES.FUTURE_DATE
  }
  
  // Validate based on record type
  if (record.record_type === 'blood_pressure') {
    return validateBloodPressure(record as BloodPressureRecord)
  }
  
  if (record.record_type === 'blood_sugar') {
    return validateBloodSugar(record as BloodSugarRecord)
  }
  
  if (record.record_type === 'weight') {
    return validateWeight(record as WeightRecord)
  }
  
  return null
}
```